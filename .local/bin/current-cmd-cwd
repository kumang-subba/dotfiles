#!/bin/bash


get_cwd(){
  local pid=$1
  readlink -f "/proc/$pid/cwd" 2>/dev/null || echo "$HOME"
}
# Go from current active terminal to its child shell process and run cwd there
terminal_pid=$(hyprctl activewindow | awk '/pid:/ {print $2}')
shell_pid=$(pgrep -P "$terminal_pid" | head -n1)

# if [[ -n $shell_pid ]]; then
#   readlink -f "/proc/$shell_pid/cwd" 2>/dev/null || echo "$HOME"
# else
#   echo "$HOME"
# fi

if [[ -n $TMUX ]]; then
  pane_pid=$(tmux display-message -p "#{pane_pid}")
  shell_pid=$(pgrep -P "$pane_pid" | head -n1)
  target_pid=${shell_pid:-$pane_pid}
  get_cwd "$target_pid"
else
  terminal_pid=$(hyprctl activewindow | awk '/pid:/ {print $2}')
  shell_pid=$(pgrep -P "$terminal_pid" | head -n1)
  target_pid=${shell_pid:-$terminal_pid}
  get_cwd "$target_pid"
fi
